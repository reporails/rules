# Unreleased

## Changed

- **BREAKING**: Renumbered rules to sequential IDs (separate namespaces):
  - Core: S6→S4, S7→S5, G2-G8→G1-G7, M6→M5
  - Claude: CLAUDE_S4→S2, CLAUDE_S5→S3, CLAUDE_M5→M1, CLAUDE_M7→M2
  - Updated schema to clarify: agent rules use OWN namespace (CLAUDE_S1 ≠ override of S1)
  - Added pattern override mechanism via `agents/{agent}/overrides/` folder

- **BREAKING**: Restructured ALL rules into directories with co-located tests:
  ```
  core/{category}/{rule-id}/
  ├── {rule-id}.md
  ├── {rule-id}.yml
  └── tests/
      ├── fail.md   # Should trigger (true positive)
      └── pass.md   # Should not trigger (true negative)
  ```

  Restructured rules (43 total):
  - Structure: S1-S5 (5)
  - Content: C1-C12 (12)
  - Efficiency: E1-E8 (8)
  - Governance: G1-G7 (7)
  - Maintenance: M1-M5 (5)
  - Claude agent: CLAUDE_S1-S3, CLAUDE_G1, CLAUDE_M1-M2 (6)

- Updated all documentation and workflows for new directory structure:
  - `.claude/skills/update-rule/SKILL.md`
  - `.claude/tasks/new-rule.md`
  - `.claude/tasks/smoke-test.md`
  - `.shared/knowledge/qa-checklist.md`
  - `.shared/workflows/qa-smoke-test.md`
  - `.shared/workflows/rule-creation.md`
  - `.shared/workflows/rule-update.md`
  - `docs/rule-template.md`
  - `CLAUDE.md`

## Fixed

- Fix pattern-not-regex rules firing on every heading line instead of checking file-level content. Changed anchor from `^#` to `(?s)\A#[\s\S]+` to match entire file. Affected rules: C4, C12, E2, E3, E4, E5

## Added

- `.semgrepignore` to allow scanning test files (semgrep ignores `tests/` by default)
- Test files (fail.md/pass.md) for all 43 rules to validate OpenGrep patterns
- [META]: `.reporails/trust-metrics.yml` generated by evidence audit
