# Schema definition for agent configuration
# Used by: ails validate, agents, contributors

schema_version: 1

# =============================================================================
# AGENT CONFIG
# =============================================================================
# Each agent defines:
# - Identity (agent, prefix, name)
# - File patterns (vars)
# - What core rules don't apply (excludes)
# - Adjustments to rules (overrides)
# =============================================================================

# Reference: reserved_agent_prefixes defined in rule.schema.yml
# Agents must use a prefix from that list.

fields:
  agent:
    required: true
    type: string
    pattern: "^[a-z]+$"
    description: "Agent identifier (lowercase)"

  prefix:
    required: true
    type: string
    pattern: "^[A-Z]+$"
    description: "Rule ID prefix for agent-specific rules. Must be in reserved_agent_prefixes (see rule.schema.yml)"

  name:
    required: true
    type: string
    max_length: 64
    description: "Human-readable agent name (max 64 chars)"

  vars:
    required: true
    type: object
    description: "Template variables for rule patterns. Universal vars required, agent-specific optional."
    properties:
      # Universal variables (REQUIRED for all agents)
      main_instruction_file:
        required: true
        type: array
        items:
          type: string
        description: "Primary instruction file(s) — document-level rules check only these"
      instruction_files:
        required: true
        type: array
        items:
          type: string
        description: "All instruction files (main + supplementary) — content rules check all"
      # Agent-specific variables (optional, only if agent supports the feature)
      supplementary_files:
        required: false
        type: array
        items:
          type: string
        description: "Rule snippet files (excludes main) — for agents with rules directory"
      rules_dir:
        required: false
        type: string
        description: "Rules directory path — for agents with hierarchical rules"
      skills_dir:
        required: false
        type: string
        description: "Skills directory path — for agents with skills support"
    additionalProperties:
      type: string
      description: "Additional agent-specific variables"

  excludes:
    required: false
    type: array
    items:
      type: string
      pattern: "^[SCEGM][0-9]+$"
    description: "Core rule IDs that don't apply to this agent"

  overrides:
    required: false
    type: object
    description: "Per-check overrides (key = check ID)"
    additionalProperties:
      type: object
      properties:
        severity:
          type: enum
          values: [critical, high, medium, low]
          description: "Override default severity"
        disabled:
          type: boolean
          description: "Disable this check for this agent"

# =============================================================================
# VALIDATION
# =============================================================================

validation:
  # Identity
  - rule: "agent must be lowercase letters only"
  - rule: "prefix must be UPPERCASE letters only"
  - rule: "prefix must be in reserved_agent_prefixes (see rule.schema.yml)"

  # Vars - Universal (required)
  - rule: "vars.main_instruction_file is required"
  - rule: "vars.instruction_files is required"

  # Vars - Agent-specific (optional)
  - rule: "supplementary_files, rules_dir, skills_dir only needed if agent supports them"

  # Excludes
  - rule: "excludes items must be valid core rule IDs or agent-specific rule IDs"

  # Overrides
  - rule: "overrides keys must be valid check IDs"
  - rule: "overrides severity must be valid severity value"

# =============================================================================
# EXAMPLES
# =============================================================================

examples:
  claude: |
    # Full-featured agent with rules directory
    agent: claude
    prefix: CLAUDE
    name: Claude Code

    vars:
      # Universal (required)
      main_instruction_file:
        - "**/CLAUDE.md"
      instruction_files:
        - "**/CLAUDE.md"
        - ".claude/rules/**/*.md"
      # Agent-specific (Claude supports rules directory)
      supplementary_files:
        - ".claude/rules/**/*.md"
      rules_dir: ".claude/rules"
      skills_dir: ".claude/skills"

  copilot: |
    # Minimal agent with single file
    agent: copilot
    prefix: COPILOT
    name: GitHub Copilot

    vars:
      # Universal only — no rules directory support
      main_instruction_file:
        - ".github/copilot-instructions.md"
      instruction_files:
        - ".github/copilot-instructions.md"

    excludes:
      - CLAUDE_S4  # Hierarchical Memory (no rules_dir)
      - CLAUDE_S5  # Path-Scoped Rules (no rules_dir)

  cursor: |
    # Agent with rules directory support
    agent: cursor
    prefix: CURSOR
    name: Cursor

    vars:
      main_instruction_file:
        - "**/.cursorrules"
      instruction_files:
        - "**/.cursorrules"
        - ".cursor/rules/**/*.md"
      supplementary_files:
        - ".cursor/rules/**/*.md"
      rules_dir: ".cursor/rules"